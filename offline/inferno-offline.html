<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Inferno Run — Offline Preview</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        background: radial-gradient(circle at top, #1a1a1a, #030303 70%);
        color: white;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        overflow: hidden;
      }
      #scene-root {
        position: absolute;
        inset: 0;
      }
      #hud {
        position: absolute;
        inset: auto 0 0 0;
        display: flex;
        flex-direction: column;
        gap: 20px;
        padding: 24px;
        pointer-events: none;
        background: linear-gradient(180deg, transparent, rgba(0, 0, 0, 0.7));
      }
      .hud-section {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 16px;
      }
      .stat-bar {
        width: 260px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        text-transform: uppercase;
        letter-spacing: 0.35em;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.6);
      }
      .stat-bar-track {
        width: 100%;
        height: 8px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.1);
        overflow: hidden;
      }
      .stat-bar-fill {
        height: 100%;
        border-radius: inherit;
        background: linear-gradient(90deg, #6fffe9, #29c7b3);
        transition: width 0.3s ease;
      }
      .stat-bar-fill[data-type="water"] {
        background: linear-gradient(90deg, #5cc0ff, #2b8efc);
      }
      .stat-bar-value {
        font-size: 14px;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.7);
      }
      .mission-meta {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        text-align: right;
        gap: 6px;
        text-transform: uppercase;
        letter-spacing: 0.45em;
        color: rgba(255, 255, 255, 0.45);
      }
      .mission-meta .time {
        font-size: 40px;
        font-weight: 900;
        letter-spacing: 0.2em;
        color: rgba(255, 255, 255, 0.9);
      }
      .mission-meta .difficulty {
        font-size: 24px;
        font-weight: 600;
        color: #ff744d;
      }
      .meta-row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        text-transform: uppercase;
        letter-spacing: 0.4em;
        color: rgba(255, 255, 255, 0.6);
        font-size: 13px;
      }
      .powerup-tags {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .powerup {
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(0, 0, 0, 0.6);
        border-radius: 999px;
        padding: 10px 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        letter-spacing: 0.3em;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
      }
      .powerup::before {
        content: "";
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: currentColor;
        box-shadow: 0 0 10px currentColor;
      }
      header {
        position: absolute;
        inset: 0 0 auto 0;
        display: flex;
        justify-content: space-between;
        padding: 24px;
        text-transform: uppercase;
        letter-spacing: 0.3em;
        color: rgba(255, 255, 255, 0.6);
        pointer-events: none;
      }
      .overlay-vignette {
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: radial-gradient(circle at center, transparent, rgba(0, 0, 0, 0.4));
      }
      @media (max-width: 768px) {
        .stat-bar {
          width: 100%;
        }
        .mission-meta {
          align-items: flex-start;
          text-align: left;
        }
      }
    </style>
  </head>
  <body>
    <div id="scene-root"></div>
    <header>
      <span>Firefighter: Inferno Run</span>
      <span>Offline preview</span>
    </header>
    <div class="overlay-vignette"></div>
    <div id="hud">
      <div class="hud-section">
        <div>
          <div class="stat-bar">
            <span>Oxygen</span>
            <div class="stat-bar-track">
              <div class="stat-bar-fill" data-bar="oxygen" style="width: 100%"></div>
            </div>
            <span class="stat-bar-value" data-value="oxygen">100%</span>
          </div>
          <div class="stat-bar">
            <span>Water</span>
            <div class="stat-bar-track">
              <div class="stat-bar-fill" data-bar="water" data-type="water" style="width: 100%"></div>
            </div>
            <span class="stat-bar-value" data-value="water">100%</span>
          </div>
        </div>
        <div class="mission-meta">
          <span>Mission Time</span>
          <span class="time" data-value="time">0s</span>
          <span>Difficulty</span>
          <span class="difficulty" data-value="difficulty">Tier 1</span>
        </div>
      </div>
      <div class="hud-section">
        <div class="meta-row">
          <span>Score <span data-value="score">0</span></span>
          <span>Civilians Saved <span data-value="civilians">0</span></span>
        </div>
        <div class="powerup-tags" id="powerup-tags"></div>
      </div>
    </div>
    <script type="module">
      import * as THREE from "https://unpkg.com/three@0.164.1/build/three.module.js";

      const powerups = [
        { id: "adrenaline", name: "Adrenaline", tint: "#ff4b1f", duration: 15 },
        { id: "pressure", name: "Pressure", tint: "#ff2d55", duration: 10 },
        { id: "thermal", name: "Thermal", tint: "#ffd166", duration: 20 },
        { id: "oxygen", name: "Oxygen", tint: "#6fffe9", duration: null },
        { id: "water", name: "Water", tint: "#29b6f6", duration: null },
        { id: "gel", name: "Gel", tint: "#f4a261", duration: 10 },
        { id: "timePulse", name: "Time Pulse", tint: "#b388ff", duration: 5 }
      ];

      const state = {
        time: 0,
        oxygen: 100,
        water: 100,
        score: 0,
        civiliansRescued: 0,
        difficultyLevel: 1,
        velocity: { x: 0, z: 0 },
        activePowerups: Object.fromEntries(powerups.map((p) => [p.id, 0]))
      };

      const sceneRoot = document.getElementById("scene-root");
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      sceneRoot.appendChild(renderer.domElement);

      const scene = new THREE.Scene();
      scene.background = new THREE.Color("#060606");
      scene.fog = new THREE.Fog("#060606", 10, 35);

      const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
      camera.position.set(0, 6, 8);
      camera.lookAt(0, 1, -4);

      const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
      scene.add(ambientLight);

      const fireLight = new THREE.DirectionalLight(new THREE.Color("#ff7f50"), 2.4);
      fireLight.position.set(6, 12, 6);
      fireLight.castShadow = true;
      fireLight.shadow.mapSize.set(1024, 1024);
      scene.add(fireLight);

      const beaconLight = new THREE.PointLight(new THREE.Color("#4dd0ff"), 1.3, 10);
      beaconLight.position.set(-3, 3, -3);
      scene.add(beaconLight);

      function createFirefighter() {
        const geometry = new THREE.CapsuleGeometry(0.6, 1.4, 8, 16);
        const material = new THREE.MeshStandardMaterial({
          color: "#ffb347",
          emissive: "#ff4b1f",
          emissiveIntensity: 0.3,
          metalness: 0.1,
          roughness: 0.6
        });
        const mesh = new THREE.Mesh(geometry, material);
        mesh.position.set(0, 1, 0);
        mesh.castShadow = true;
        return mesh;
      }

      function createFireZone() {
        const group = new THREE.Group();
        const material = new THREE.MeshStandardMaterial({ color: "#ff4b1f", emissive: "#ff2d00", emissiveIntensity: 1.5 });
        for (let i = 0; i < 6; i += 1) {
          const cone = new THREE.Mesh(new THREE.ConeGeometry(0.4, 1.2, 8, 1), material);
          const angle = (i / 6) * Math.PI * 2;
          cone.position.set(Math.cos(angle) * 1.4, 0.4, Math.sin(angle) * 1.4);
          cone.castShadow = true;
          group.add(cone);
        }
        group.position.set(0, 0, -4);
        return { group, material };
      }

      function createCivilianBeacon() {
        const geometry = new THREE.IcosahedronGeometry(0.6, 0);
        const material = new THREE.MeshStandardMaterial({ color: "#4dd0ff", emissive: "#2fb7ff", emissiveIntensity: 1.8 });
        const mesh = new THREE.Mesh(geometry, material);
        mesh.position.set(-2.5, 1.4, -6);
        mesh.castShadow = true;
        return mesh;
      }

      function createPowerupOrbs() {
        const group = new THREE.Group();
        powerups.forEach((powerup, index) => {
          const sphere = new THREE.Mesh(
            new THREE.SphereGeometry(0.35, 24, 24),
            new THREE.MeshStandardMaterial({
              color: powerup.tint,
              emissive: powerup.tint,
              emissiveIntensity: 1.4,
              transparent: true,
              opacity: 0.85
            })
          );
          sphere.position.set(0, index * 0.9, 0);
          sphere.castShadow = true;
          group.add(sphere);
        });
        group.position.set(2.5, 0.8, -5);
        return group;
      }

      function createSmokeLayer() {
        const geometry = new THREE.CircleGeometry(10, 32);
        const material = new THREE.MeshBasicMaterial({ color: "#2a2a2a", opacity: 0.15, transparent: true });
        const mesh = new THREE.Mesh(geometry, material);
        mesh.rotation.set(Math.PI / 2, 0, 0);
        mesh.position.set(0, 6, -4);
        return mesh;
      }

      function createStars(count = 3000) {
        const positions = new Float32Array(count * 3);
        for (let i = 0; i < count; i += 1) {
          const radius = 20 + Math.random() * 10;
          const theta = Math.random() * Math.PI * 2;
          const phi = Math.acos(2 * Math.random() - 1);
          positions[i * 3] = radius * Math.sin(phi) * Math.cos(theta);
          positions[i * 3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
          positions[i * 3 + 2] = radius * Math.cos(phi);
        }
        const geometry = new THREE.BufferGeometry();
        geometry.setAttribute("position", new THREE.BufferAttribute(positions, 3));
        const material = new THREE.PointsMaterial({ color: "#ffffff", size: 0.12, sizeAttenuation: true, transparent: true, opacity: 0.75 });
        const points = new THREE.Points(geometry, material);
        points.frustumCulled = false;
        return points;
      }

      const firefighter = createFirefighter();
      const fireZone = createFireZone();
      const civilianBeacon = createCivilianBeacon();
      const powerupOrbs = createPowerupOrbs();
      const smokeLayer = createSmokeLayer();
      const stars = createStars();
      const ground = new THREE.Mesh(
        new THREE.PlaneGeometry(30, 30),
        new THREE.MeshStandardMaterial({ color: "#202020", metalness: 0.2, roughness: 0.9 })
      );
      ground.rotation.set(-Math.PI / 2, 0, 0);
      ground.receiveShadow = true;

      scene.add(firefighter, fireZone.group, civilianBeacon, powerupOrbs, smokeLayer, stars, ground);

      function buildPowerupTags() {
        const container = document.getElementById("powerup-tags");
        container.innerHTML = "";
        powerups.forEach((powerup) => {
          const tag = document.createElement("span");
          tag.className = "powerup";
          tag.style.color = powerup.tint;
          tag.dataset.id = powerup.id;
          tag.textContent = `${powerup.name}${powerup.duration ? ` — ${powerup.duration}s` : ""}`;
          container.appendChild(tag);
        });
      }

      buildPowerupTags();

      function tick(delta) {
        const oxygenDrainMultiplier = state.activePowerups.adrenaline > 0 ? 1.1 : 1;
        const waterDrainMultiplier = state.activePowerups.pressure > 0 ? 2 : 1;
        const gelPenalty = state.activePowerups.gel > 0 ? 0.7 : 1;

        state.time += delta;
        state.difficultyLevel = Math.min(10, 1 + Math.floor(state.time / 60));
        const oxygenDrain = 2.4 * delta * state.difficultyLevel * oxygenDrainMultiplier;
        const waterDrain = 1.5 * delta * (1 + state.difficultyLevel * 0.15) * waterDrainMultiplier;
        state.oxygen = Math.max(0, state.oxygen - oxygenDrain);
        state.water = Math.max(0, state.water - waterDrain);

        Object.keys(state.activePowerups).forEach((key) => {
          state.activePowerups[key] = Math.max(0, state.activePowerups[key] - delta);
        });

        const milestoneReached = Math.floor(state.time / 15) > Math.floor((state.time - delta) / 15);
        if (milestoneReached) {
          state.score += 12 * state.difficultyLevel;
          if (Math.random() > 0.7) {
            state.civiliansRescued += 1;
          }
        }

        state.velocity.x = THREE.MathUtils.damp(state.velocity.x, gelPenalty * 0.4 * Math.sin(state.time), 2.5, delta);
        state.velocity.z = THREE.MathUtils.damp(state.velocity.z, gelPenalty * 0.8 * Math.cos(state.time), 2.5, delta);
      }

      function updateHud() {
        const oxygenBar = document.querySelector('[data-bar="oxygen"]');
        const waterBar = document.querySelector('[data-bar="water"]');
        const oxygenValue = document.querySelector('[data-value="oxygen"]');
        const waterValue = document.querySelector('[data-value="water"]');
        const timeValue = document.querySelector('[data-value="time"]');
        const difficultyValue = document.querySelector('[data-value="difficulty"]');
        const scoreValue = document.querySelector('[data-value="score"]');
        const civiliansValue = document.querySelector('[data-value="civilians"]');

        const clamp = (value) => Math.max(0, Math.min(100, value));

        oxygenBar.style.width = `${clamp(state.oxygen)}%`;
        waterBar.style.width = `${clamp(state.water)}%`;
        oxygenValue.textContent = `${state.oxygen.toFixed(0)}%`;
        waterValue.textContent = `${state.water.toFixed(0)}%`;
        timeValue.textContent = `${state.time.toFixed(0)}s`;
        difficultyValue.textContent = `Tier ${state.difficultyLevel}`;
        scoreValue.textContent = state.score.toFixed(0);
        civiliansValue.textContent = state.civiliansRescued;
      }

      const clock = new THREE.Clock();
      let elapsed = 0;

      function animate() {
        const delta = clock.getDelta();
        elapsed += delta;

        tick(delta);
        updateHud();

        firefighter.position.x += state.velocity.x * delta;
        firefighter.position.z += state.velocity.z * delta;
        firefighter.rotation.y = THREE.MathUtils.lerp(
          firefighter.rotation.y,
          Math.atan2(state.velocity.x, state.velocity.z || 1),
          0.2
        );

        const intensity = (Math.sin(elapsed * 2) + 1.5) / 2;
        fireZone.material.emissiveIntensity = 1.2 + intensity * 0.8;
        fireZone.group.children.forEach((child, index) => {
          child.position.y = 0.3 + Math.sin(elapsed * 3 + index) * 0.2;
        });
        fireZone.group.rotation.y += delta * 0.1;
        renderer.setClearColor(new THREE.Color(0.03 + intensity * 0.02, 0.02, 0.02), 1);

        civilianBeacon.rotation.y += delta * 0.6;
        const beaconScale = 1 + Math.sin(elapsed * 1.2) * 0.1;
        civilianBeacon.scale.set(beaconScale, beaconScale, beaconScale);

        powerupOrbs.children.forEach((child, index) => {
          child.position.x = Math.sin(elapsed * 1.5 + index) * 0.1;
        });

        smokeLayer.rotation.z += delta * 0.02;
        stars.rotation.y += delta * 0.02;

        const heatHaze = (1 - state.oxygen / 100) * 0.4;
        const fogDensity = (state.difficultyLevel / 10) * 0.2;
        document.body.style.setProperty("--heat-haze", heatHaze.toFixed(2));
        document.body.style.setProperty("--smoke-density", fogDensity.toFixed(2));
        document.title = `Inferno Run — T${state.time.toFixed(0)} · O${state.oxygen.toFixed(0)} · W${state.water.toFixed(0)}`;

        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      }

      animate();

      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>
  </body>
</html>
